<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <style>
        html, body, div, span, applet, object, iframe,
        h1, h2, h3, h4, h5, h6, p, blockquote, pre,
        a, abbr, acronym, address, big, cite, code,
        del, dfn, em, img, ins, kbd, q, s, samp,
        small, strike, strong, sub, sup, tt, var,
        b, u, i, center,
        dl, dt, dd, ol, ul, li,
        fieldset, form, label, legend,
        table, caption, tbody, tfoot, thead, tr, th, td,
        article, aside, canvas, details, embed,
        figure, figcaption, footer, header, hgroup,
        menu, nav, output, ruby, section, summary,
        time, mark, audio, video {
            margin: 0;
            padding: 0;
            border: 0;
            vertical-align: baseline;
        }

        /* HTML5 display-role reset for older browsers */
        article, aside, details, figcaption, figure,
        footer, header, hgroup, menu, nav, section {
            display: block;
        }

        body {
            line-height: 1.5;
            font-size: 16px;
        }

        * {
            box-sizing: border-box;
        }

        ol, ul {
            list-style: none;
        }

        blockquote, q {
            quotes: none;
        }

        blockquote:before, blockquote:after,
        q:before, q:after {
            content: '';
            content: none;
        }

        table {
            border-collapse: collapse;
            border-spacing: 0;
        }

        html, body, #app, .main-wrap {
            height: 100%;
            width: 100%;
        }

        a {
            color: #3B7ED1;
            text-decoration: none !important;
        }

        body, button {
            font-family: PingFangSC-Regular, Helvetica Neue, Hiragino Sans GB, Helvetica, Microsoft YaHei, Arial;
        }

        input, button, select, textarea {
            outline: none
        }

        /*滚动条整体部分,必须要设置*/
        ::-webkit-scrollbar {
            width: 1px;
            height: 1px;
            background-color: transparent;
        }

        /*滚动条的轨道*/
        ::-webkit-scrollbar-track {
            box-shadow: inset 0 0 1px transparent;
            background-color: transparent;
        }

        /*滚动条的滑块按钮*/
        ::-webkit-scrollbar-thumb {
            border-radius: 1px;
            background-color: transparent;
            box-shadow: inset 0 0 1px transparent;
        }

        /*滚动条的上下两端的按钮*/
        ::-webkit-scrollbar-button {
            height: 1px;
            background-color: transparent;
        }


    </style>
    <style>
        * {
            box-sizing: border-box
        }

        .container {
            width: 1202px;
            margin: 0 auto;
            position: relative;
            height: 100%;
            background: #f6f6f6;
            border-right: 1px solid #ccc;
            border-left: 1px solid #ccc;
        }

        header {
            height: 40px;
            background: #f1f1f1;
            border-bottom: 1px solid #ccc;
        }

        header .add-cate {
            width: 150px;
            text-align: center;
            line-height: 36px;
            height: 40px;
            border-left: 1px solid #ccc;
            cursor: pointer;
            float: right;
        }

        header .list-cate {
            width: 1050px;
            float: right;
            height: 40px;
            white-space: nowrap;
            overflow-x: auto;
            text-align: right;
        }

        header .list-cate ul li {
            width: 150px;
            line-height: 45px;
            height: 40px;
            font-size: 14px;
            display: inline-block;
            border-left: 1px solid #ccc;
            padding-right: 15px;
            cursor: pointer;
        }
        header .list-cate ul li.active{
            color: #1e87f0;
        }
        .content {
            position: absolute;
            top: 40px;
            bottom: 0;
            width: 100%;
        }

        aside {
            height: 100%;
            width: 150px;
            overflow-y: auto;
            float: left;
            background: #f1f1f1;
            border-right: 1px solid #ccc;
        }

        section {
            width: 1050px;
            float: left;
            height: 100%;
            overflow-y: auto;
        }

        .add-item {
            text-align: center;
            line-height: 45px;
            height: 45px;
            border-bottom: 1px solid #ccc;
            cursor: pointer;
        }

        aside ul li {
            line-height: 30px;
            text-align: center;
            border-bottom: 1px solid #ccc;
            cursor: pointer;
        }
        aside ul li.active{
            color: #1e87f0;
        }
        section {
            padding: 15px;
        }

        section h4 {
            line-height: 45px;
            border-bottom: 1px solid #ccc;
        }

        section .info .item {
            float: left;
            line-height: 60px;

            border-bottom: 1px solid #ccc;
        }

        .col-5 {
            width: 50%
        }

        .col-10 {
            width: 100%
        }

        section .info .item span {
            width: 100px;
            display: inline-block;
            vertical-align: baseline;
        }

        section .info .item input, section .info .item select, section .info .item textarea {
            width: calc(100% - 200px);
            height: 40px;
            border: 1px solid #ddd;
            padding: 10px;
        }

        section .info .item textarea {
            height: 80px
        }

        .info-2 {
            position: relative;
        }

        .info-2 .btn {
            position: absolute;
            height: 100%;
            width: 150px;
            top: 0;
            right: 0;
            line-height: 45px;
            text-align: right;
            padding-right: 15px;
            cursor: pointer;
        }

        .tab-content .head{
            height: 40px
        }

        .tab-content .head p, .item-j {
            float: left;
            line-height: 40px;
            padding-left: 15px;
            border-bottom: 1px solid #ccc;
            border-left: 1px solid #ccc;
        }

        .item-j {
            padding-left: 5px;
            height: 40px
        }
        .item-j input{max-width: 90%}
        .item-j.item-2 input {
            border: none;
            width: 95%;
            height: 30px;
            background: none;
        }

        .item-j.item-3 {
            padding: 0 12px
        }

        .item-j.item-3 select {
            width: 100%;
        }

        .item-j span {
            text-align: center;
            font-size: 20px;
            display: inline-block;
            margin: 0 10px;
            cursor: pointer;
        }

        .add-col {
            padding: 15px;
            cursor: pointer;
        }
    </style>
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://cdn.bootcss.com/layer/3.1.0/layer.js"></script>
    <script>
        $(function () {
            // 添加分类
            $('.add-cate').on('click', function () {
                layer.open({
                    type: 1,
                    shade: false,
                    btn:['确认'],
                    title: '添加分类', //不显示标题
                    content: $('.add-cate-box'), //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
                    yes: function (index, layero) {
                        $.ajax({
                            type: "post",
                            url: "/___api/cate/add",
                            data: {name:layero.find('input').val()},
                            dataType: "json",
                            success: function(rst){
                                if(rst.code != 0 ){
                                    layer.msg(rst.msg)
                                }else {
                                    let item = rst.data
                                    $('.list-cate ul')
                                        .append(`<li cate-id="${item.id}">${item.name}</li>`)
                                }
                                layer.close(index)
                            }
                        });

                    }
                });
            })
            $('.list-cate ul').delegate('li .delete-cate','click',function (e) {
                var parent = $(this).parent()
                var id = parent.attr('cate-id')
                e.stopPropagation()
                e.preventDefault()
                layer.confirm('是否删除该模块下所有的接口？', {
                    btn: ['确认','取消'] //按钮
                }, function(){
                    $.ajax({
                        type: "post",
                        url: "/___api/cate/delete",
                        data: {
                            id:id,
                        },
                        dataType: "json",
                        success: function(rst){
                            if(rst.code == '0'){
                                parent.remove()
                                $('.list-cate ul li[cate-id="0000000000"]').click()
                                layer.msg(rst.msg)
                            }else {
                                layer.msg(rst.msg)
                            }
                        }
                    });
                }, function(){

                });
            })
            
            $('.list-cate ul').delegate('li','click',function () {
                var _this = $(this),id = _this.attr('cate-id')
                setCate(_this.index())
                $.ajax({
                    type: "post",
                    url: "/___api/cate/get",
                    data: {id:id},
                    dataType: "json",
                    success: function(rst){
                        let list = rst.data;
                        let html = ''
                        $('aside ul').html('')
                        list.forEach(function (item) {
                            html += '<li cate-url="'+item.id+'" cate-id="'+item.cateId+'">'+item.apiName+'</li>'
                        })
                        $('aside ul').append(html)
                        $('.add-item').click()
                    }
                });
            })
            function setCate(index){
                var liDom = $('.list-cate ul li')
                liDom.removeClass('active')
                $('.list-cate ul li').eq(index).addClass('active')
            }
            $('.delete-data').on('click',function () {

                layer.confirm('是否要删除改接口？', {
                    btn: ['确认','取消'] //按钮
                }, function(){
                    var id = $('aside ul li.active').attr('cate-url')?$('aside ul li.active').attr('cate-url'):''
                    var cateId = $('.list-cate ul li.active').attr('cate-id')
                    $.ajax({
                        type: "post",
                        url: "/___api/list/delete",
                        data: {
                            id:id,
                            cateId:cateId
                        },
                        dataType: "json",
                        success: function(rst){
                            if(rst.code == '0'){
                                $('.list-cate ul li.active').remove()
                                $('.add-item').click()
                                layer.msg(rst.msg)
                            }else {
                                layer.msg(rst.msg)
                            }
                        }
                    });
                }, function(){

                });
            })
            $('.confirm-data').on('click',function () {
                var data = getInputData($('.info'))
                var listData = getApiItems($('.tab-content .list > .item'))
                var id = $('.list-cate ul li.active').attr('cate-id')
                data.list = listData
                data.cateId = id
                data.id = $('aside ul li.active').attr('cate-url')?$('aside ul li.active').attr('cate-url'):''
                $.ajax({
                    type: "post",
                    url: "/___api/list/add",
                    data: {data:JSON.stringify(data)},
                    dataType: "json",
                    success: function(rst){
                        if(rst.code != 0 ){
                            layer.msg(rst.msg)
                        }else {
                            let item = rst.data
                            layer.msg(rst.msg)
                            if(item.save){
                                return
                            }
                            $('aside ul li').removeClass('active')
                            $('aside ul')
                                .prepend(`<li class="active" cate-url="${item.id}" cate-id="${item.cateId}">${item.apiName}</li>`)
                        }
                    }
                });
            })
            function getInputData(item) {
                var data = {}
                item.find('input').each(function(index,item){
                    var dom = $(item)
                    data[dom.attr('id')] = dom.val()
                })
                item.find('textarea').each(function(index,item){
                    var dom = $(item)
                    data[dom.attr('id')] = dom.val()
                })
                item.find('select').each(function(index,item){
                    var dom = $(item)
                    data[dom.attr('id')] = dom.val()
                })
                return data
            }
            function getListInputData(item) {
                var data = {}
                item.find('>div > input').each(function(index,item){
                    var dom = $(item)
                    data[dom.attr('id')] = dom.val()
                })
                item.find('>div > textarea').each(function(index,item){
                    var dom = $(item)
                    data[dom.attr('id')] = dom.val()
                })
                item.find('>div > select').each(function(index,item){
                    var dom = $(item)
                    data[dom.attr('id')] = dom.val()
                })
                return data
            }
            function getApiItems(items){
                var data = []
                items.each(function(index,item){
                    var dom = $(item)
                    var domData = getListInputData(dom)
                    var itemSon = dom.find('> .son > .item')
                    if(itemSon.length>0){
                        domData.son = getApiItems(itemSon)
                    }
                    data.push(domData)
                })
                return data
            }
            var tpl = `<div class="item">
                            <div style="width: 10%" class="item-j"><span class="delete-item">×</span><span sort="1" class="add-son">+</span></div>
                            <div style="width: 30%" class="item-j item-2">
                                <input id="name" type="text">
                            </div>
                            <div style="width: 10%" class="item-j item-3">
                                <select id="is">
                                    <option value="0">false</option>
                                    <option value="1">true</option>
                                </select>
                            </div>
                            <div style="width: 15%" class="item-j item-3">
                                <select id="type">
                                    <option value="string">string</option>
                                    <option value="number">number</option>
                                    <option value="object">object</option>
                                    <option value="boolean">boolean</option>

                                    <option value="array[number]">array[number]</option>
                                    <option value="array[string]">array[string]</option>
                                    <option value="array[object]">array[object]</option>
                                    <option value="array[boolean]">array[boolean]</option>
                                    <option value="array[array]">array[array]</option>
                                </select>
                            </div>
                            <div style="width: 15%" class="item-j">
                                <input type="text" id="spec" placeholder="长度">
                            </div>
                            <div style="width: 10%" class="item-j">
                                <input type="text" id="val">
                            </div>
                            <div style="width: 10%" class="item-j">
                                <input type="text" id="desp">
                            </div>
                            <div  class="son" style="width: 100%;float: left"></div>
                            <div style="clear: both"></div>
                        </div>`;
            $('.add-col').on('click',function () {
                $('.tab-content .list').append(tpl);
            })
            $('.list').delegate('.delete-item','click',function (){
                var _this = $(this),sort = _this.attr('sort'),_parent = _this.parent().parent()
                if(['array[array]','object','array','array[object]'].indexOf(_parent.find('#type').val()) != -1){
                    layer.confirm('当前会删除所有子节点？', {
                        btn: ['确认','取消'] //按钮
                    }, function(){
                        _parent.remove()
                        layer.msg('删除成功');
                    })
                    return
                }
                _parent.remove()
            })
            $('.list').delegate('.add-son','click',function () {
                var _this = $(this),sort = _this.attr('sort'),_parent = _this.parent().parent()
                if(['array[array]','object','array','array[object]'].indexOf(_parent.find('#type').val()) == -1){
                    layer.msg('Object和Array才可以添加属性..')
                    return
                }
                var tplDom = $(tpl);
                tplDom.find('.item-2').css('padding-left',15*sort+5)
                tplDom.find('.add-son').attr('sort',sort*1+1)
                _parent.find('>.son').append(tplDom);
            })
            $('.add-item').on('click',function () {
                $('aside ul li').removeClass('active')
                $('.tab-content .list').html('')
                $('input').val('')
                $('#apiDesp').val('')
                $('select').val('get')
            })
            $('aside ul').delegate('li','click',function () {
                $('.add-item').click()
                $('aside ul li').removeClass('active')
                var id = $('.list-cate ul li.active').attr('cate-id'),_this = $(this),
                    apiUrl = _this.attr('cate-url')
                _this.addClass('active')
                $.ajax({
                    type: "post",
                    url: "/___api/list/get",
                    data: {id:id,apiUrl:apiUrl},
                    dataType: "json",
                    success: function(rst){
                        setInfos(rst.data)
                    }
                });
            })
            function setInfos(data) {
                $('#apiName').val(data.apiName)
                $('#apiDesp').val(data.apiDesp)
                $('#apiUrl').val(data.apiUrl)
                $('#apiMethod').val(data.apiMethod)
                var list = $('.tab-content .list');
                data.list.forEach(function (item) {
                    list.append(setItemInfos(item))
                })
                list.find('>.item').each(function (index,item) {
                    setInfoStyle(item)
                })
            }
            function setInfoStyle(item,index) {
                index = index || 0
                var sonIndex = index +1
                item = $(item)
                item.find('.add-son').attr('sort',sonIndex)
                item.find('.item-2').css('padding-left',15*index+5)

                var son = item.find(' > .son')
                if(son && son.length>0){
                    son.find('>.item').each(function (index,item) {
                        setInfoStyle(item,sonIndex)
                    })
                }
            }
            function setItemInfos(item) {
                var domTpl = $(tpl)
                domTpl.find('#desp').val(item.desp)
                domTpl.find('#is').val(item.is)
                domTpl.find('#name').val(item.name)
                domTpl.find('#spec').val(item.spec)
                domTpl.find('#type').val(item.type)
                domTpl.find('#val').val(item.val)
                // tplDom.find('.item-2').css('padding-left',15*sort+5)
                // tplDom.find('.add-son').attr('sort',sort*1+1)
                if(item.son && item.son.length>0){
                    item.son.forEach(function (sonItem) {
                        domTpl.find(' > .son').append(setItemInfos(sonItem))
                    })

                }
                return domTpl
            }
        })
    </script>
</head>
<body>
<style>
    .add-cate-box .item {
        padding: 20px;
    }
    .add-cate-box .item input {
        height: 30px;
    }
</style>
<div class="add-cate-box" style="display: none">
    <div class="item">
        <span>分类名称：</span>
        <input type="text">
    </div>
</div>
<div class="container">
    <header>
        <p class="add-cate">+ 添加分类</p>
        <div class="list-cate">
            <ul>
                <% cate.forEach(function(item){%>
                <li style="position: relative" class="<% if(item.id == 0){ %>active<% } %>" cate-id="<%=item.id %>">
                    <% if(item.id != 0){ %><span class="delete-cate" style="position:absolute;left:0;
                    text-align: center;font-size: 20px;display: inline-block;margin: 0 10px;cursor: pointer;color: #333;">×</span><% } %>
                    <%=item.name %></li>
                <% }) %>

            </ul>
        </div>
    </header>
    <div class="content">
        <aside>
            <p class="add-item">+ 添加接口</p>
            <ul>
                <% apiLists.forEach(function(item){%>
                <li cate-url="<%=item.id %>" cate-id="<%=item.cateId %>"><%=item.apiName %></li>
                <% }) %>
            </ul>
        </aside>
        <section>
            <div class="info-2">
                <h4>基本信息</h4>
                <div class="btn" style="right: 155px">
                    <p class="delete-data" style="border: 1px solid #ddd;border-radius: 3px;text-align: center;
                        line-height: 35px;">删除</p>
                </div>
                <div class="btn">
                    <p class="confirm-data" style="border: 1px solid #ddd;border-radius: 3px;text-align: center;
                        line-height: 35px;">提交数据</p>
                </div>
            </div>
            <div class="info" style="margin-top: 20px">
                <div class="item col-5">
                    <span>接口名称：</span>
                    <input id="apiName" value="<%=currentApi.apiName %>" type="text">
                </div>
                <div class="item col-5">
                    <span>请求方法：</span>
                    <select id="apiMethod" value="<%=currentApi.apiMethod %>">
                        <option value="get">get</option>
                        <option value="post">post</option>
                        <option value="delete">delete</option>
                        <option value="put">put</option>
                        <option value="post">post</option>
                    </select>
                </div>
                <div class="item col-10">
                    <span>接口地址：</span>
                    <input id="apiUrl" value="<%=currentApi.apiUrl %>" type="text">
                </div>
                <div class="item col-10" style="padding-top: 20px;border: none">
                    <span>接口描述：</span>
                    <textarea name="" value="<%=currentApi.apiDesp %>" id="apiDesp" cols="30" rows="10"></textarea>
                </div>
                <div style="clear: both"></div>
            </div>
            <div class="info-2">
                <h4 style="margin-top: 20px">接口信息</h4>
                <div class="btn">
                    <p>+ 导入json</p>
                </div>
            </div>
            <div class="tab-content" style="border-right: 1px solid #ccc">
                <div class="head">
                    <p style="width: 10%">操作</p>
                    <p style="width: 30%">参数名</p>
                    <p style="width: 10%">是否必须</p>
                    <p style="width: 15%">类型</p>
                    <p style="width: 15%">规则(默认值)</p>
                    <p style="width: 10%">默认值</p>
                    <p style="width: 10%">描述</p>
                </div>
                <div class="list">

                </div>
                <p class="add-col">+ 添加</p>
            </div>
        </section>
    </div>
</div>
</body>
</html>
